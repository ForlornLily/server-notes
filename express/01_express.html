<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>express | server-notes</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/server-notes/favicon.ico">
    <meta name="description" content="个人后端笔记">
    
    <link rel="preload" href="/server-notes/assets/css/0.styles.45babf2f.css" as="style"><link rel="preload" href="/server-notes/assets/js/app.0ba0bae6.js" as="script"><link rel="preload" href="/server-notes/assets/js/2.9f4da93a.js" as="script"><link rel="preload" href="/server-notes/assets/js/1.0c602107.js" as="script"><link rel="preload" href="/server-notes/assets/js/21.fb06ef30.js" as="script"><link rel="prefetch" href="/server-notes/assets/js/10.f7ac8fdb.js"><link rel="prefetch" href="/server-notes/assets/js/11.ed50545f.js"><link rel="prefetch" href="/server-notes/assets/js/12.c87b6f55.js"><link rel="prefetch" href="/server-notes/assets/js/13.49cc3c30.js"><link rel="prefetch" href="/server-notes/assets/js/14.da83e645.js"><link rel="prefetch" href="/server-notes/assets/js/15.ceb6d509.js"><link rel="prefetch" href="/server-notes/assets/js/16.20431cf1.js"><link rel="prefetch" href="/server-notes/assets/js/17.41e60837.js"><link rel="prefetch" href="/server-notes/assets/js/18.6d3b94c1.js"><link rel="prefetch" href="/server-notes/assets/js/19.c72a28f3.js"><link rel="prefetch" href="/server-notes/assets/js/20.d13f92f3.js"><link rel="prefetch" href="/server-notes/assets/js/22.9346754a.js"><link rel="prefetch" href="/server-notes/assets/js/23.50b94556.js"><link rel="prefetch" href="/server-notes/assets/js/24.70e1bc51.js"><link rel="prefetch" href="/server-notes/assets/js/25.614f85d2.js"><link rel="prefetch" href="/server-notes/assets/js/26.c01ff9a6.js"><link rel="prefetch" href="/server-notes/assets/js/27.b27c70c6.js"><link rel="prefetch" href="/server-notes/assets/js/28.73db57f1.js"><link rel="prefetch" href="/server-notes/assets/js/29.5573bcb2.js"><link rel="prefetch" href="/server-notes/assets/js/3.fd1fec73.js"><link rel="prefetch" href="/server-notes/assets/js/30.a85369fb.js"><link rel="prefetch" href="/server-notes/assets/js/31.cf62f430.js"><link rel="prefetch" href="/server-notes/assets/js/32.5a963fd3.js"><link rel="prefetch" href="/server-notes/assets/js/33.3bd2f683.js"><link rel="prefetch" href="/server-notes/assets/js/34.44921d6b.js"><link rel="prefetch" href="/server-notes/assets/js/35.b4a06870.js"><link rel="prefetch" href="/server-notes/assets/js/36.9ffdb97b.js"><link rel="prefetch" href="/server-notes/assets/js/37.bf596c7c.js"><link rel="prefetch" href="/server-notes/assets/js/38.338e554f.js"><link rel="prefetch" href="/server-notes/assets/js/39.a1ca9b86.js"><link rel="prefetch" href="/server-notes/assets/js/4.283fc3ad.js"><link rel="prefetch" href="/server-notes/assets/js/40.6983c0d6.js"><link rel="prefetch" href="/server-notes/assets/js/41.d122f2af.js"><link rel="prefetch" href="/server-notes/assets/js/42.c9c24c6f.js"><link rel="prefetch" href="/server-notes/assets/js/43.2ecdd8bd.js"><link rel="prefetch" href="/server-notes/assets/js/44.e2773cc2.js"><link rel="prefetch" href="/server-notes/assets/js/45.17841a16.js"><link rel="prefetch" href="/server-notes/assets/js/46.73a28b0f.js"><link rel="prefetch" href="/server-notes/assets/js/47.909bba31.js"><link rel="prefetch" href="/server-notes/assets/js/48.f9779c2e.js"><link rel="prefetch" href="/server-notes/assets/js/49.f8a355b8.js"><link rel="prefetch" href="/server-notes/assets/js/5.b7b571d1.js"><link rel="prefetch" href="/server-notes/assets/js/50.bfcddbf3.js"><link rel="prefetch" href="/server-notes/assets/js/51.711a0185.js"><link rel="prefetch" href="/server-notes/assets/js/52.c3b2c425.js"><link rel="prefetch" href="/server-notes/assets/js/53.c3c5ee1c.js"><link rel="prefetch" href="/server-notes/assets/js/54.a3a3e678.js"><link rel="prefetch" href="/server-notes/assets/js/55.1adcc97c.js"><link rel="prefetch" href="/server-notes/assets/js/56.fcb20cbf.js"><link rel="prefetch" href="/server-notes/assets/js/57.68073c10.js"><link rel="prefetch" href="/server-notes/assets/js/58.9b51ffd5.js"><link rel="prefetch" href="/server-notes/assets/js/59.cf1836b6.js"><link rel="prefetch" href="/server-notes/assets/js/6.a8df54d8.js"><link rel="prefetch" href="/server-notes/assets/js/60.5708f53a.js"><link rel="prefetch" href="/server-notes/assets/js/61.9dd18978.js"><link rel="prefetch" href="/server-notes/assets/js/62.c2e0ecc6.js"><link rel="prefetch" href="/server-notes/assets/js/63.ac4b2478.js"><link rel="prefetch" href="/server-notes/assets/js/64.bbca387c.js"><link rel="prefetch" href="/server-notes/assets/js/65.a9893a0a.js"><link rel="prefetch" href="/server-notes/assets/js/66.31faeac4.js"><link rel="prefetch" href="/server-notes/assets/js/67.c3c55ccf.js"><link rel="prefetch" href="/server-notes/assets/js/68.670eea54.js"><link rel="prefetch" href="/server-notes/assets/js/7.494b0a7a.js"><link rel="prefetch" href="/server-notes/assets/js/vendors~docsearch.162bdabc.js">
    <link rel="stylesheet" href="/server-notes/assets/css/0.styles.45babf2f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/server-notes/" class="home-link router-link-active"><!----> <span class="site-name">server-notes</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/server-notes/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端框架" class="dropdown-title"><span class="title">后端框架</span> <span class="arrow down"></span></button> <button type="button" aria-label="后端框架" class="mobile-dropdown-title"><span class="title">后端框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/server-notes/express/" class="nav-link router-link-active">
  Express
</a></li><li class="dropdown-item"><!----> <a href="/server-notes/koa/" class="nav-link">
  koa
</a></li><li class="dropdown-item"><!----> <a href="/server-notes/nest/" class="nav-link">
  nest
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/server-notes/sql/" class="nav-link">
  SQL
</a></li><li class="dropdown-item"><!----> <a href="/server-notes/mysql/" class="nav-link">
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/server-notes/mongodb/" class="nav-link">
  MongoDB
</a></li><li class="dropdown-item"><!----> <a href="/server-notes/redis/" class="nav-link">
  Redis
</a></li></ul></div></div><div class="nav-item"><a href="https://forlornlily.github.io/fe-notes/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  前端
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/ForlornLily/server-notes" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/server-notes/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端框架" class="dropdown-title"><span class="title">后端框架</span> <span class="arrow down"></span></button> <button type="button" aria-label="后端框架" class="mobile-dropdown-title"><span class="title">后端框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/server-notes/express/" class="nav-link router-link-active">
  Express
</a></li><li class="dropdown-item"><!----> <a href="/server-notes/koa/" class="nav-link">
  koa
</a></li><li class="dropdown-item"><!----> <a href="/server-notes/nest/" class="nav-link">
  nest
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/server-notes/sql/" class="nav-link">
  SQL
</a></li><li class="dropdown-item"><!----> <a href="/server-notes/mysql/" class="nav-link">
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/server-notes/mongodb/" class="nav-link">
  MongoDB
</a></li><li class="dropdown-item"><!----> <a href="/server-notes/redis/" class="nav-link">
  Redis
</a></li></ul></div></div><div class="nav-item"><a href="https://forlornlily.github.io/fe-notes/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  前端
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/ForlornLily/server-notes" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Express</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/server-notes/express/" aria-current="page" class="sidebar-link">概要</a></li><li><a href="/server-notes/express/01_express.html" aria-current="page" class="active sidebar-link">express</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/server-notes/express/01_express.html#next" class="sidebar-link">next()</a></li><li class="sidebar-sub-header"><a href="/server-notes/express/01_express.html#res-send" class="sidebar-link">res.send</a></li><li class="sidebar-sub-header"><a href="/server-notes/express/01_express.html#res-format" class="sidebar-link">res.format</a></li><li class="sidebar-sub-header"><a href="/server-notes/express/01_express.html#node-env" class="sidebar-link">NODE_ENV</a></li><li class="sidebar-sub-header"><a href="/server-notes/express/01_express.html#use-middleware" class="sidebar-link">use(middleware)</a></li><li class="sidebar-sub-header"><a href="/server-notes/express/01_express.html#路由拆分" class="sidebar-link">路由拆分</a></li><li class="sidebar-sub-header"><a href="/server-notes/express/01_express.html#express-static" class="sidebar-link">express.static</a></li></ul></li><li><a href="/server-notes/express/02_demo.html" class="sidebar-link">简单 demo</a></li><li><a href="/server-notes/express/03.generator.html" class="sidebar-link">Express 应用生成器</a></li><li><a href="/server-notes/express/04_router.html" class="sidebar-link">路由</a></li><li><a href="/server-notes/express/05_static.html" class="sidebar-link">静态文件</a></li><li><a href="/server-notes/express/06_req_and_res.html" class="sidebar-link">Request 和 Response</a></li><li><a href="/server-notes/express/07_middleware.html" class="sidebar-link">中间件</a></li><li><a href="/server-notes/express/30_views.html" class="sidebar-link">视图</a></li><li><a href="/server-notes/express/31_form.html" class="sidebar-link">处理表单</a></li><li><a href="/server-notes/express/32_cookie.html" class="sidebar-link">Cookie 和 Session</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="express"><a href="#express" class="header-anchor">#</a> express</h1> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">use: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>req<span class="token punctuation">.</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span> <span class="token comment">//use: 不论是什么方法都会进</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/api'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">get: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>req<span class="token punctuation">.</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span> <span class="token comment">//get请求的时候会进</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/api/foo'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">get: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>req<span class="token punctuation">.</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span> <span class="token comment">//get请求的时候会进</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token string">'3000'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">app is running in port 3000</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>访问 http://localhost:3000/api
会进 use /api，因为 use 写了 next()，所以会进 get /api</li> <li>访问 http://localhost:3000/api/foo
同理会进 use /api 和 get /api/foo</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/user/:name'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>:name: 通过 req.params.name 取到实际的值</p> <p>比如访问 <code>http://localhost:3000/user/hello</code> 返回的是 <code>hello</code></p> <h2 id="next"><a href="#next" class="header-anchor">#</a> next()</h2> <div class="language-js extra-class"><pre class="language-js"><code>app<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token string">'/user/:name'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 页面始终在 pending（因为第一个没有返回）；第二个路径被拦截，不会执行</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/user/:name'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'world'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/user/:name'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 调用 next 进行链式调用</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/user/:name'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'world'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="res-send"><a href="#res-send" class="header-anchor">#</a> res.send</h2> <h2 id="res-format"><a href="#res-format" class="header-anchor">#</a> res.format</h2> <p>根据 ajax 的请求消息头返回对应的内容</p> <p>页面 ajax</p> <p><img src="data:image/png;base64,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" alt=""></p> <p>express 内响应</p> <p><img src="/server-notes/assets/img/4c1c3ad3085bb726301195ae0ef751e7.4c1c3ad3.png" alt=""></p> <h2 id="node-env"><a href="#node-env" class="header-anchor">#</a> NODE_ENV</h2> <p>告知 Node 程序运行在哪个环境中，其默认是开发环境</p> <h2 id="use-middleware"><a href="#use-middleware" class="header-anchor">#</a> use(middleware)</h2> <p>app.use 加载用于处理 http 請求的 middleware（中间件），当一个请求来的时候，会依次被这些 middlewares 处理<br>
当业务逻辑复杂的时候，为了明确和便于维护，需要把处理的事情分一下，分配成几个部分来做，而每个部分就是一个中间件<br>
本质上中间件就是个函数</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 示例中间件函数</span>
<span class="token keyword">const</span> <span class="token function-variable function">a_middleware_function</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ... 进行一些操作</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 调用 next() ，Express 将调用处理链中下一个中间件函数。</span>
<span class="token punctuation">}</span>

<span class="token comment">// 用 use() 为所有的路由和动词添加该函数</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>a_middleware_function<span class="token punctuation">)</span>

<span class="token comment">// 用 use() 为一个特定的路由添加该函数</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/someroute'</span><span class="token punctuation">,</span> a_middleware_function<span class="token punctuation">)</span>

<span class="token comment">// 为一个特定的 HTTP 动词和路由添加该函数</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> a_middleware_function<span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>使用 app.use(fn)后，传进来的 fn 就会被扔到一个函数数组</li> <li>执行完毕后调用 next()方法执行函数数组里的下一个函数，如果没有调用 next()的话，就不会调用下一个函数</li> <li>中间件存在调用顺序，要保证依赖顺序正常</li></ul> <h2 id="路由拆分"><a href="#路由拆分" class="header-anchor">#</a> 路由拆分</h2> <p>利用 <code>use</code><br>
比如将 <code>user</code> 模块作为 <code>/user</code> 的路由</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/* user.js */</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/about'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'about'</span><span class="token punctuation">)</span> <span class="token comment">// 访问 /user/about 返回 `about`</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/* app.js */</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./user'</span><span class="token punctuation">)</span>
<span class="token comment">// 特定路由添加的中间件</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span>
</code></pre></div><h2 id="express-static"><a href="#express-static" class="header-anchor">#</a> express.static</h2> <p>读取静态文件，包括 CSS、图片、文件等</p> <div class="language-js extra-class"><pre class="language-js"><code>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span><span class="token string">'public'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// static 其实是一个中间件</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span><span class="token string">'media'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 如果 public 内没有找到对应的资源，会去找 media</span>
</code></pre></div><p><code>public</code> 文件夹可以直接通过路由访问，比如 <code>http://localhost:3000/images/dog.jpg</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 指定路由</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'/media'</span><span class="token punctuation">,</span> express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span><span class="token string">'public'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// http://localhost:3000/media/images/dog.jpg`</span>
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/ForlornLily/server-notes/edit/master/docs/express/01_express.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">11/5/2020, 5:49:17 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/server-notes/express/" class="prev router-link-active">
        概要
      </a></span> <span class="next"><a href="/server-notes/express/02_demo.html">
        简单 demo
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/server-notes/assets/js/app.0ba0bae6.js" defer></script><script src="/server-notes/assets/js/2.9f4da93a.js" defer></script><script src="/server-notes/assets/js/1.0c602107.js" defer></script><script src="/server-notes/assets/js/21.fb06ef30.js" defer></script>
  </body>
</html>
